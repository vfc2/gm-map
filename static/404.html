<!doctype html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>GitHub Pages Redirect</title>
		<script type="text/javascript">
			// Single Page Apps for GitHub Pages
			// MIT License
			// This script takes the current url and converts the path and query
			// string into just a query string, and then redirects the browser
			// to the new url with only a query string and hash fragment

			// Dynamic path segments calculation
			function calculatePathSegmentsToKeep() {
				var path = window.location.pathname;

				// For PR preview paths in the format /org/repo/pr-preview/pr-XX/
				if (path.includes('/pr-preview/pr-')) {
					console.debug('PR preview path detected:', path);
					// Count segments before the app routes
					var pathParts = path.split('/').filter(Boolean);
					var prIndex = pathParts.findIndex((part) => part === 'pr-preview');
					if (prIndex >= 0 && prIndex + 1 < pathParts.length) {
						console.debug('PR preview segments:', pathParts, 'keeping', prIndex + 2);
						return prIndex + 2; // +2 for 'pr-preview' and 'pr-XX'
					}
					console.debug('Falling back to 4 segments for PR preview');
					return 4; // Default for PR preview paths: /org/repo/pr-preview/pr-XX
				}

				console.debug('Using default 2 segments for regular GitHub Pages');
				return 2; // Default for regular GitHub Pages project sites
			}

			var pathSegmentsToKeep = calculatePathSegmentsToKeep();
			console.log('Path segments to keep:', pathSegmentsToKeep);

			var l = window.location;
			var basePath = l.pathname.split('/').slice(0, pathSegmentsToKeep).join('/');
			var route = l.pathname.slice(basePath.length);

			if (route === '') route = '/';

			console.log('Base path:', basePath);
			console.log('Route:', route);

			l.replace(
				l.protocol +
					'//' +
					l.hostname +
					(l.port ? ':' + l.port : '') +
					basePath +
					'/?/' +
					route.slice(1).replace(/&/g, '~and~') +
					(l.search ? '&' + l.search.slice(1).replace(/&/g, '~and~') : '') +
					l.hash
			);
		</script>
	</head>
	<body>
		Redirecting...
	</body>
</html>
